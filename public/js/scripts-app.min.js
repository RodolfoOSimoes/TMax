var csrfToken=document.querySelector('meta[name="csrf-token"]').getAttribute("content");axios.defaults.headers.common["X-CSRF-TOKEN"]=csrfToken,biologic.air.Notify.configure({destroy:"both",delay:4e3,animation:"slide"});
function moneyReal(t,e,n,r){return e=isNaN(e=Math.abs(e))?2:e,n=null==n?",":n,r=null==r?".":r,s=t<0?"-":"",i=parseInt(t=Math.abs(+t||0).toFixed(e))+"",j=3<(j=i.length)?j%3:0,s+(j?i.substr(0,j)+r:"")+i.substr(j).replace(/(\d{3})(?=\d)/g,"$1"+r)+(e?n+Math.abs(t-i).toFixed(e).slice(2):"")}function moneyRealSign(t,e,n,r){return"R$ "+moneyReal(t,e,n,r)}function dateToStringBr(t){var e=t.getDate();1==e.toString().length&&(e="0"+e);var n=t.getMonth()+1;return 1==n.toString().length&&(n="0"+n),e+"/"+n+"/"+t.getFullYear()}function covertDateBr(t){return dateToStringBr(new Date(t+" 03:00:00"))}
function diffDatesInDays(e,t){var a=Math.abs(t.getTime()-e.getTime());return Math.ceil(a/864e5)}
var UserService={defaultError:"An error has occurred",login:function(s,t){axios.post("/users/login",s).then(function(s){"success"==s.data.status?t.onSuccess&&t.onSuccess.call(this,s.data):"warning"==s.data.status&&t.onWarning&&t.onWarning.call(this,s.data)}).catch(function(s){t.onError&&t.onError.call(this,{status:"Error",message:this.defaultError})})},logout:function(t){axios.post("/users/logout").then(function(s){"success"==s.data.status?t.onSuccess&&t.onSuccess.call(this,s.data):"warning"==s.data.status&&t.onWarning&&t.onWarning.call(this,s.data)}).catch(function(s){t.onError&&t.onError.call(this,{status:"Error",message:this.defaultError})})},getAuth:function(t){axios.get("/users/get-auth").then(function(s){"success"==s.data.status?t.onSuccess&&t.onSuccess.call(this,s.data):"warning"==s.data.status&&t.onWarning&&t.onWarning.call(this,s.data)}).catch(function(s){t.onError&&t.onError.call(this,{status:"Error",message:this.defaultError})})},create:function(s,t){axios.post("/users/create",s).then(function(s){"success"==s.data.status?t.onSuccess&&t.onSuccess.call(this,s.data):"warning"==s.data.status&&t.onWarning&&t.onWarning.call(this,s.data)}).catch(function(s){t.onError&&t.onError.call(this,{status:"Error",message:this.defaultError})})},update:function(s,t){axios.post("/users/update/"+s.id,s).then(function(s){"success"==s.data.status?t.onSuccess&&t.onSuccess.call(this,s.data):"warning"==s.data.status&&t.onWarning&&t.onWarning.call(this,s.data)}).catch(function(s){t.onError&&t.onError.call(this,{status:"Error",message:this.defaultError})})},all:function(t){axios.get("/users/all").then(function(s){"success"==s.data.status?t.onSuccess&&t.onSuccess.call(this,s.data):"warning"==s.data.status&&t.onWarning&&t.onWarning.call(this,s.data)}).catch(function(s){t.onError&&t.onError.call(this,{status:"Error",message:this.defaultError})})},find:function(s,t){axios.get("/users/"+s).then(function(s){"success"==s.data.status?t.onSuccess&&t.onSuccess.call(this,s.data):"warning"==s.data.status&&t.onWarning&&t.onWarning.call(this,s.data)}).catch(function(s){t.onError&&t.onError.call(this,{status:"Error",message:this.defaultError})})},delete:function(s,t){axios.post("/users/delete/"+s).then(function(s){"success"==s.data.status?t.onSuccess&&t.onSuccess.call(this,s.data):"warning"==s.data.status&&t.onWarning&&t.onWarning.call(this,s.data)}).catch(function(s){t.onError&&t.onError.call(this,{status:"Error",message:this.defaultError})})}};
var UsersRolesService={defaultError:"An error has occurred",all:function(s){axios.get("/users-roles/all").then(function(r){"success"==r.data.status?s.onSuccess&&s.onSuccess.call(this,r.data):"warning"==r.data.status&&s.onWarning&&s.onWarning.call(this,r.data)}).catch(function(r){s.onError&&s.onError.call(this,{status:"Error",message:this.defaultError})})}};
var NotificationsService={notify:function(s){if("success"==s.status)s.message&&biologic.air.Notify.success(s.message);else if("warning"==s.status)if(s.message)biologic.air.Notify.warning(s.message);else for(var i in s.messages)biologic.air.Notify.warning(s.messages[i]);"error"==s.status&&biologic.air.Notify.error(s.message)}};
var BooksService={defaultError:"An error has occurred",create:function(a,t){axios.post("/books/create",a).then(function(a){"success"==a.data.status?t.onSuccess&&t.onSuccess.call(this,a.data):"warning"==a.data.status&&t.onWarning&&t.onWarning.call(this,a.data)}).catch(function(a){t.onError&&t.onError.call(this,{status:"Error",message:this.defaultError})})},update:function(a,t){axios.post("/books/update/"+a.id,a).then(function(a){"success"==a.data.status?t.onSuccess&&t.onSuccess.call(this,a.data):"warning"==a.data.status&&t.onWarning&&t.onWarning.call(this,a.data)}).catch(function(a){t.onError&&t.onError.call(this,{status:"Error",message:this.defaultError})})},all:function(t){axios.get("/books/all").then(function(a){"success"==a.data.status?t.onSuccess&&t.onSuccess.call(this,a.data):"warning"==a.data.status&&t.onWarning&&t.onWarning.call(this,a.data)}).catch(function(a){t.onError&&t.onError.call(this,{status:"Error",message:this.defaultError})})},find:function(a,t){axios.get("/books/"+a).then(function(a){"success"==a.data.status?t.onSuccess&&t.onSuccess.call(this,a.data):"warning"==a.data.status&&t.onWarning&&t.onWarning.call(this,a.data)}).catch(function(a){t.onError&&t.onError.call(this,{status:"Error",message:this.defaultError})})},delete:function(a,t){axios.post("/books/delete/"+a).then(function(a){"success"==a.data.status?t.onSuccess&&t.onSuccess.call(this,a.data):"warning"==a.data.status&&t.onWarning&&t.onWarning.call(this,a.data)}).catch(function(a){t.onError&&t.onError.call(this,{status:"Error",message:this.defaultError})})}};
var ReservationsService={defaultError:"An error has occurred",create:function(a,t){axios.post("/reservations/create",a).then(function(a){"success"==a.data.status?t.onSuccess&&t.onSuccess.call(this,a.data):"warning"==a.data.status&&t.onWarning&&t.onWarning.call(this,a.data)}).catch(function(a){t.onError&&t.onError.call(this,{status:"Error",message:this.defaultError})})},update:function(a,t){axios.post("/reservations/update/"+a.id,a).then(function(a){"success"==a.data.status?t.onSuccess&&t.onSuccess.call(this,a.data):"warning"==a.data.status&&t.onWarning&&t.onWarning.call(this,a.data)}).catch(function(a){t.onError&&t.onError.call(this,{status:"Error",message:this.defaultError})})},all:function(t){axios.get("/reservations/all").then(function(a){"success"==a.data.status?t.onSuccess&&t.onSuccess.call(this,a.data):"warning"==a.data.status&&t.onWarning&&t.onWarning.call(this,a.data)}).catch(function(a){t.onError&&t.onError.call(this,{status:"Error",message:this.defaultError})})},allCustom:function(t){axios.get("/reservations/all-custom").then(function(a){"success"==a.data.status?t.onSuccess&&t.onSuccess.call(this,a.data):"warning"==a.data.status&&t.onWarning&&t.onWarning.call(this,a.data)}).catch(function(a){t.onError&&t.onError.call(this,{status:"Error",message:this.defaultError})})},details:function(a,t){axios.get("/reservations/details/"+a).then(function(a){"success"==a.data.status?t.onSuccess&&t.onSuccess.call(this,a.data):"warning"==a.data.status&&t.onWarning&&t.onWarning.call(this,a.data)}).catch(function(a){t.onError&&t.onError.call(this,{status:"Error",message:this.defaultError})})},deliver:function(a,t){axios.post("/reservations/deliver/"+a).then(function(a){"success"==a.data.status?t.onSuccess&&t.onSuccess.call(this,a.data):"warning"==a.data.status&&t.onWarning&&t.onWarning.call(this,a.data)}).catch(function(a){t.onError&&t.onError.call(this,{status:"Error",message:this.defaultError})})},delete:function(a,t){axios.post("/reservations/delete/"+a).then(function(a){"success"==a.data.status?t.onSuccess&&t.onSuccess.call(this,a.data):"warning"==a.data.status&&t.onWarning&&t.onWarning.call(this,a.data)}).catch(function(a){t.onError&&t.onError.call(this,{status:"Error",message:this.defaultError})})}};
var PAGE_LOGIN_TEMPLATE='<div class="login" v-cloak><div class="login__main"><div class="login__header"><h2 class="logotype">Books</h2></div><div class="login__body"><h3>Entrar</h3><div class="fieldset"><label class="input input--text"><input type="text" v-model="email" placeholder="Email"></label></div><div class="fieldset"><label class="input input--text"><input type="password" v-model="password" placeholder="Senha"></label></div><div class="fieldset"><a class="button button--default button--full" v-on:click="login">Entrar</a></div></div></div></div>';Vue.component("page-login",{template:PAGE_LOGIN_TEMPLATE,data:function(){return{email:"",password:""}},methods:{login:function(){var s=this;UserService.login({email:this.email,password:this.password},{onSuccess:function(){window.location.assign("/dashboard")},onWarning:function(i){s.password="",NotificationsService.notify(i)},onError:function(i){s.password="",NotificationsService.notify(i)}})}}});
var PANEL_MENU_TEMPLATE='<div class="panel-menu" v-cloak><div class="panel-menu__user"><span class="panel-menu__user__name">{{ user }}</span><a v-on:click="logout" class="panel-menu__user__link">Sair</a></div><ul class="panel-menu__menu"><li :class="{\'panel-menu__item--active\' : page == \'books\'}" v-if="\'admin\' == permission || \'user\' == permission" class="panel-menu__item"><a href="/books">Livros</a></li><li :class="{\'panel-menu__item--active\' : page == \'reservations\'}" v-if="\'admin\' == permission || \'user\' == permission"  class="panel-menu__item"><a href="/reservations">Reservas</a></li><li :class="{\'panel-menu__item--active\' : page == \'users\'}" v-if="\'admin\' == permission"  class="panel-menu__item"><a href="/users">Usuários</a></li></ul></div>';Vue.component("panel-menu",{template:PANEL_MENU_TEMPLATE,props:["page"],computed:{permission:function(){return this.$root.role},user:function(){return this.$root.user}},methods:{logout:function(){UserService.logout({onSuccess:function(e){window.location.assign("/")}})}}});
var PANEL_TEMPLATE='<div class="panel" v-cloak>\x3c!-- menu --\x3e<div class="panel__menu"><panel-menu :page="page" ></panel-menu></div>\x3c!-- end menu --\x3e\x3c!-- content --\x3e<slot></slot>\x3c!-- end content --\x3e</div>';Vue.component("panel",{template:PANEL_TEMPLATE,props:["page"]});
var PAGE_BOOKS_TEMPLATE='<div class="page-books" v-cloak><panel page="books">\x3c!-- content --\x3e<div class="page-books__main"><div class="page-books__header"><h1>> Livros</h1></div>\x3c!-- list --\x3e<div v-show="\'list\' == mode" class="page-books__list"><div class="page-books__list__header"><a v-if="\'admin\' == permission" v-on:click="createMode" class="button button--default">Adicionar</a></div><div class="page-books__list__books"><div v-for="book in books" class="page-books__list__book"><div class="page-books__list__book__code"><p><strong>Cod.:&nbsp;<span>{{ book.id }}</span></strong></p></div><div class="page-books__list__book__info"><p>{{ book.name }}</p><p>{{ book.author }}</p></div><div class="page-books__list__book__price"><p>{{ moneyRealSign(book.price) }}</p></div><div class="page-books__list__book__control"><a v-if="\'admin\' == permission || \'user\' == permission" v-on:click="reserveBook(book.id)" class="page-books__list__book__option"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" style="display: block; pointer-events: none;" viewBox="0 0 24 24"><path d="M18,22A2,2 0 0,0 20,20V4C20,2.89 19.1,2 18,2H12V9L9.5,7.5L7,9V2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18Z" /></svg></a><a v-if="\'admin\' == permission" v-on:click="editMode(book.id)" class="page-books__list__book__option"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" style="display: block; pointer-events: none;" viewBox="0 0 24 24"><path d="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.21,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.67 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z" /></svg></a></div></div></div></div>\x3c!-- end list --\x3e\x3c!-- form --\x3e<div v-show="\'edit\' == mode || \'create\' == mode" class="page-books__form"><div class="fieldset"><label class="input input--text"><input type="text" v-model="form.name" placeholder="Nome do livro"></label></div><div class="fieldset"><label class="input input--text"><input type="text" v-model="form.author" placeholder="Autores do livro"></label></div><div class="fieldset"><label class="input input--text"><input type="text" v-model="form.image" placeholder="Capa do livro"></label></div><div class="row"><div class="col-6"><div class="fieldset"><label class="input input--text"><input type="text" v-model="form.amount" placeholder="Quantidade de livros"></label></div></div><div class="col-6"><div class="fieldset"><label class="input input--text"><input type="text" v-model="form.price" placeholder="Preço da reserva"></label></div></div></div><div class="fieldset fieldset--right"><a class="button button--secondary button--margin-right" v-on:click="cancelBook">Cancel</a><a v-show="\'edit\' == mode" class="button button--danger button--margin-right" v-on:click="deleteBook">Excluir</a><a class="button button--default" v-on:click="saveBook">Salvar</a></div></div>\x3c!-- end form --\x3e</div>\x3c!-- end content --\x3e</panel></div>';Vue.component("page-books",{template:PAGE_BOOKS_TEMPLATE,data:function(){return{mode:"",form:{id:0,name:"",image:"",author:"",price:"",amount:""},books:[]}},computed:{permission:function(){return this.$root.role}},methods:{listMode:function(o){this.mode="list",o&&(this.books=[],this.loadAllBooks())},editMode:function(o){this.clearForm(),this.loadBookDetails(o),this.mode="edit"},createMode:function(){this.clearForm(),this.mode="create"},reserveBook:function(o){window.location.assign("/reservations?mode=create&book="+o)},loadAllBooks:function(){var i=this;BooksService.all({onSuccess:function(o){i.books=o.data}})},loadBookDetails:function(o){var i=this;BooksService.find(o,{onSuccess:function(o){i.setForm(o.data)}})},setForm:function(o){o&&(this.form.id=o.id,this.form.name=o.name,this.form.image=o.image,this.form.author=o.author,this.form.price=o.price,this.form.amount=o.amount)},clearForm:function(){this.form.id=0,this.form.name="",this.form.image="",this.form.author="",this.form.price="",this.form.amount=""},cancelBook:function(){this.listMode()},saveBook:function(){var i=this;this.form.id?BooksService.update(this.form,{onSuccess:function(o){NotificationsService.notify(o),i.listMode(!0)},onWarning:function(o){NotificationsService.notify(o)}}):BooksService.create(this.form,{onSuccess:function(o){NotificationsService.notify(o),i.listMode(!0)},onWarning:function(o){NotificationsService.notify(o)}})},deleteBook:function(){var i=this;BooksService.delete(this.form.id,{onSuccess:function(o){NotificationsService.notify(o),i.listMode(!0)}})}},created:function(){this.listMode(!0)}});
var PAGE_USERS_TEMPLATE='<div v-if="\'admin\' == permission" class="page-users" v-cloak><panel page="users">\x3c!-- content --\x3e<div class="page-users__main"><div class="page-users__header"><h1>> Usuários</h1></div>\x3c!-- list --\x3e<div v-show="\'list\' == mode" class="page-users__list"><div class="page-users__list__header"><a v-on:click="createMode" class="button button--default">Adicionar</a></div><div class="page-users__list__users"><div v-for="user in users" class="page-users__list__user"><div class="page-users__list__user__code"><p><strong>{{ user.id }}</strong></p></div><div class="page-users__list__user__name"><p>{{ user.name }}</p></div><div class="page-users__list__user__email"><p>{{ user.email }}</p></div><div class="page-users__list__user__control"><a v-on:click="editMode(user.id)" class="page-users__list__user__option"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" style="display: block; pointer-events: none;" viewBox="0 0 24 24"><path d="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.21,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.67 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z" /></svg></a></div></div></div></div>\x3c!-- end list --\x3e\x3c!-- form --\x3e<div v-show="\'edit\' == mode || \'create\' == mode" class="page-users__form"><div class="fieldset"><label class="input"><input type="text" v-model="form.name" placeholder="Nome"></label></div><div class="fieldset"><label class="input"><input type="text" v-model="form.email" placeholder="Email"></label></div><div class="row"><div class="col-6"><div class="fieldset"><label class="input"><input type="password" v-model="form.password" placeholder="Senha"></label></div></div><div class="col-6"><div class="fieldset"><label class="select"><select v-model="form.user_role_id"><option value="0" disabled selected>Tipo</option><option v-for="userRole in usersRoles" :value="userRole.id">{{ userRole.name }}</option></select></label></div></div></div><div class="fieldset fieldset--right"><a class="button button--secondary button--margin-right" v-on:click="cancelUser">Cancel</a><a v-show="\'edit\' == mode" class="button button--danger button--margin-right" v-on:click="deleteUser">Excluir</a><a class="button button--default" v-on:click="saveUser">Salvar</a></div></div>\x3c!-- end form --\x3e</div>\x3c!-- end content --\x3e</panel></div>';Vue.component("page-users",{template:PAGE_USERS_TEMPLATE,data:function(){return{mode:"",form:{id:0,name:"",email:"",password:"",user_role_id:0},usersRoles:[],users:[]}},computed:{permission:function(){return this.$root.role}},methods:{listMode:function(e){this.mode="list",e&&(this.users=[],this.loadAllUsers())},editMode:function(e){this.clearForm(),this.loadUserDetails(e),this.mode="edit"},createMode:function(){this.clearForm(),this.mode="create"},loadAllUsersRoles:function(){var s=this;UsersRolesService.all({onSuccess:function(e){s.usersRoles=e.data}})},loadAllUsers:function(){var s=this;UserService.all({onSuccess:function(e){s.users=e.data}})},loadUserDetails:function(e){var s=this;UserService.find(e,{onSuccess:function(e){s.setForm(e.data)}})},setForm:function(e){e&&(this.form.id=e.id,this.form.name=e.name,this.form.email=e.email,this.form.user_role_id=e.user_role_id)},clearForm:function(){this.form.id=0,this.form.name="",this.form.email="",this.form.password="",this.form.user_role_id=0},cancelUser:function(){this.listMode()},saveUser:function(){var s=this;this.form.id?UserService.update(this.form,{onSuccess:function(e){NotificationsService.notify(e),s.listMode(!0)},onWarning:function(e){NotificationsService.notify(e)}}):UserService.create(this.form,{onSuccess:function(e){NotificationsService.notify(e),s.listMode(!0)},onWarning:function(e){NotificationsService.notify(e)}})},deleteUser:function(){var s=this;UserService.delete(this.form.id,{onSuccess:function(e){NotificationsService.notify(e),s.listMode(!0)}})}},created:function(){this.loadAllUsersRoles(),this.listMode(!0)}});
var PAGE_RESERVATIONS_TEMPLATE='<div class="page-reservations" v-cloak><panel page="reservations">\x3c!-- content --\x3e<div class="page-reservations__main"><div class="page-reservations__header"><h1>> Reservas</h1></div>\x3c!-- list --\x3e<div v-show="\'list\' == mode" class="page-reservations__list"><div class="page-reservations__list__header"><a v-if="\'admin\' == permission || \'user\' == permission" v-on:click="createMode" class="button button--default">Reservar</a></div><div class="page-reservations__list__reservations"><div v-for="reservation in reservations" class="page-reservations__list__reservation"><div class="page-reservations__list__reservation__code"><p><strong>Cod.:&nbsp;<span>{{ reservation.id }}</span></strong></p></div><div class="page-reservations__list__reservation__info"><p>{{ reservation.book_name }}</p></div><div class="page-reservations__list__reservation__date"><p>{{ covertDateBr(reservation.delivery_date) }}</p></div><div class="page-reservations__list__reservation__status"><p>{{ reservation.status == \'1\' ? \'entregue\' : \'pendente\' }}</p></div><div class="page-reservations__list__reservation__control"><a v-if="\'admin\' == permission || \'user\' == permission" v-on:click="editMode(reservation.id)" class="page-reservations__list__reservation__option"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" style="display: block; pointer-events: none;" viewBox="0 0 24 24"><path d="M18,22A2,2 0 0,0 20,20V4C20,2.89 19.1,2 18,2H12V9L9.5,7.5L7,9V2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18Z" /></svg></a></div></div></div></div>\x3c!-- end list --\x3e\x3c!-- form --\x3e<div v-show="\'edit\' == mode || \'create\' == mode || \'view\' == mode" class="page-reservations__form"><div v-if="\'admin\' == permission" class="fieldset"><label class="input input--text"><label class="select"><select v-model="form.user_id"><option value="0" disabled selected>Usuário</option><option v-for="user in users" :value="user.id">{{ user.name }}</option></select></label></label></div><div class="row"><div class="col-6"><div class="fieldset"><label class="select"><select v-model="form.book_id" :disabled="\'user\' == permission && \'edit\' == mode"><option value="0" disabled selected>Livro</option><option v-for="book in books" :value="book.id">{{ book.name }}</option></select></label></div></div><div class="col-6"><div class="fieldset"><label class="input input--text"><input type="text" v-model="form.book_price" placeholder="Preço" disabled></label></div></div></div><div class="row"><div class="col-6"><div class="fieldset"><label class="select"><select v-model="form.reservation_days" :disabled="\'user\' == permission && \'edit\' == mode"><option value="0" disabled selected>Dias</option><option v-for="day in days" :value="day">{{ day }}</option></select></label></div></div><div class="col-6"><div class="fieldset"><label class="input input--text"><input type="text" v-model="form.delivery_date" placeholder="Data de entrega" disabled></label></div></div></div><div class="row"><div class="col-6"></div><div class="col-6"><div class="fieldset"><label class="input input--text"><input type="text" v-model="form.price" placeholder="Preço" disabled></label></div></div></div><div class="fieldset fieldset--right"><a class="button button--secondary button--margin-right" v-on:click="cancelReservation">Cancel</a><a v-if="\'edit\' == mode && \'admin\' == permission" class="button button--danger button--margin-right" v-on:click="deleteReservation">Excluir</a><a v-if="\'edit\' == mode && form.status == 0" class="button button--default button--margin-right" v-on:click="deliverReservation">Entregar</a><a v-if="\'admin\' == permission || \'create\' == mode" class="button button--default" v-on:click="saveReservation">Salvar</a></div></div>\x3c!-- end form --\x3e</div>\x3c!-- end content --\x3e</panel></div>';Vue.component("page-reservations",{template:PAGE_RESERVATIONS_TEMPLATE,data:function(){return{mode:"",form:{id:0,user_id:0,book_id:0,book_price:moneyRealSign(0),reservation_days:0,reservation_date:"",delivery_date:"",price:moneyRealSign(0),status:0},users:[],books:[],days:[1,2,3,4,5,6,7,8,9,10,11,12],reservations:[]}},watch:{"form.book_id":function(i){var s,e=this;return this.books.forEach(function(e){e.id==i&&(s=e)}),s?(e.form.book_price=moneyRealSign(s.price),e.form.price=moneyRealSign(s.price*e.form.reservation_days)):(e.form.book_price=moneyRealSign(0),e.form.price=moneyRealSign(0)),i},"form.reservation_days":function(e){if(0==e)this.form.delivery_date="",t.form.price=moneyRealSign(0);else{var i,s=new Date;s.setDate(s.getDate()+e),this.form.delivery_date=dateToStringBr(s);var t=this;this.books.forEach(function(e){e.id==t.form.book_id&&(i=e)}),t.form.price=i?moneyRealSign(i.price*t.form.reservation_days):moneyRealSign(0)}return e},userID:function(e){return this.form.user_id=e}},computed:{permission:function(){return this.$root.role},userID:function(){return this.$root.id}},methods:{listMode:function(e){this.mode="list",e&&(this.reservations=[],this.loadAllReservations())},editMode:function(e){this.clearForm(),this.loadReservationDetails(e),this.mode="edit"},createMode:function(e){this.clearForm(),e&&(this.form.book_id=e),this.mode="create"},loadAllReservations:function(){var i=this;ReservationsService.allCustom({onSuccess:function(e){i.reservations=e.data}})},loadAllBooks:function(){var i=this;BooksService.all({onSuccess:function(e){i.books=e.data}})},loadAllUsers:function(){var i=this;UserService.all({onSuccess:function(e){i.users=e.data}})},loadReservationDetails:function(e){var i=this;ReservationsService.details(e,{onSuccess:function(e){i.setForm(e.data)}})},setForm:function(e){e&&(this.form.id=e.id,this.form.user_id=e.user_id,this.form.book_id=e.book_id,this.form.reservation_days=diffDatesInDays(new Date(e.delivery_date),new Date(e.reservation_date)),this.form.reservation_date=e.reservation_date,this.form.status=e.status)},clearForm:function(){this.form.id=0,this.form.user_id=this.userID,this.form.book_id=0,this.form.reservation_days=0,this.form.reservation_date="",this.form.status=0},cancelReservation:function(){this.listMode()},saveReservation:function(){var i=this;this.form.id?ReservationsService.update(this.form,{onSuccess:function(e){NotificationsService.notify(e),i.listMode(!0)},onWarning:function(e){NotificationsService.notify(e)}}):ReservationsService.create(this.form,{onSuccess:function(e){NotificationsService.notify(e),i.listMode(!0)},onWarning:function(e){NotificationsService.notify(e)}})},deleteReservation:function(){var i=this;ReservationsService.delete(this.form.id,{onSuccess:function(e){NotificationsService.notify(e),i.listMode(!0)}})},deliverReservation:function(){var i=this;ReservationsService.deliver(this.form.id,{onSuccess:function(e){NotificationsService.notify(e),i.listMode(!0)}})}},created:function(){this.loadAllUsers(),this.loadAllBooks(),this.loadAllReservations();var e=new URL(window.location.href),i=e.searchParams.get("mode"),s=e.searchParams.get("book");"create"==i&&s?this.createMode(s):this.listMode()}});
var application=new Vue({el:"#application",data:{logged:!1,id:0,user:"",role:""},methods:{loadAuth:function(){var o=this;UserService.getAuth({onSuccess:function(e){var a=e.data;null!=a&&(o.logged=!0,o.id=a.user.id,o.user=a.user.name,o.role=a.role.code)}})}},created:function(){this.loadAuth()}});